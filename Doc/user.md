# 授权模块

虽然这里提供了 `apps/logic/src/mod/user` 模块, 但这处理方式不是那么合理, 仅仅是开发方便而已.

> 游戏服务端应该尽可能保持纯粹, 不该将原本属于其他模块的功能赋予给服务端.

游戏服务端最多只能容忍以下服务, 剩余的第三方服务绝对不要放在游戏服务端.

- `日志服务`: 记录玩家操作日志
- `接口服务`: 对接 API 和后台操作接口

登录授权接口一般都由独立 Web 服务构建, 例如用 `PHP/Java` 等搭建的服务平台, 具体流程:

1. 用户向独立的 `Web` 服务请求登录
2. 独立的 `Web` 服务直接检查验证密码
3. 验证完成检查服务器是否处于开服状态, 非开服状态 `Web` 返回错误信息
4. 服务器目前开服的话生成不重复 `token` 推送到游戏服务端接口
5. 服务端推送完成将 `token` 连带服务器地址等信息返回客户端
6. 客户端接收到服务器地址信息之后 `Sid+Token` 推送给服务端请求

> 这里虽然增加项目复杂度, 但是其实是很有必要的.

首先就是将游戏授权校验更新服务移交给外部可以降低游戏服务端内部复杂度,
其次第三方SDK复杂度参差不齐导致可能验证出现超时崩溃等情况.

> 第三方授权验证SDK一般都很少 `Erlang` 版本, 需要自己构建处理 `HTTP` 请求进行验证等, 有的SDK文档写得稀烂只能自己思考怎么处理.

同时还有个问题就是授权 `SDK` 有问题常常要进行重新更新, 包括增减第三方渠道SDK都要停机更新重新处理一遍.

基于以上种种掉过坑的情况, 后续授权登录方法都是移交独立的 `Web` 服务进行处理, 不过还是需要说明下目前集成内部的授权功能.

> 账号授权登录功能位于 `apps/logic/src/mod/user`

常规开发阶段直接提供 `账号+密码` 登录的授权方便开发, 后续按照项目情况扩展出第三方登录授权模块.

另外需要注意 `Uid ≠ RoleId`:

- `Uid`: 用户|账号Id, 是用户|账号在 `整个游戏唯一`
- `RoleId`: 角色|玩家Id, 是角色|玩家在 `整个服务器中的唯一`

假定你打算游玩以腾讯QQ账号游玩某款游戏, 那么当你登录时候在游戏方来说你就在游戏方生成唯一账号;
而当你选服|创建角色完成之后就在所在服务器生成角色信息, 那么这个角色就是你账号旗下角色A;
这时候如果重新切换服务器创建角色, 那么这个角色就是你账号就是角色B.

以上面例子就说明 `游戏账号和游戏角色` 区别: 对于单个账号玩家用户来说, 游戏账号有且只有一个而角色可以有多个且绑定该账号.

所以千万要区分好: `Uid ≠ RoleId`, 且是 `一(Uid)对多(RoleId)关系`


