# 首次启动

这里是涉及到 `游戏客户端` 和 `游戏服务端` 相关会涉及到网络封包传输的情况, 所以需要一定前置知识.

如果以正式版上线客户端启动的时候, 首先需要做请求 `SDK` 获取服务器列表:

```shell
# 请求API服务器获取到服务器列表
curl 127.0.0.1:8080/api/server/list
```

这里提供返回类似的 `JSON` 格式:

```json
[
  {
    "id": 1,
    "name": "本地测试服",
    "state": 1,
    "address": "127.0.0.1",
    "port": 9377
  },
  {
    "id": 2,
    "name": "远程测试服",
    "state": 1,
    "address": "192.168.1.100",
    "port": 9377
  }
]
```

主要返回对应返回 `address` 和 `port` 就是返回服务端地址, 用于给玩家选服连接.

> 不过只有唯一服务器的时候可以直接连接去跳过选服步骤

如果想上多平台网络游戏就需要加上分服HTTP接口服务, 因为后续要上很多平台如 `Steam|WeGame|GooglePlay|Apple` 等其他渠道平台,
各自渠道平台可能有数据限制要求需要数据不互通.

不过在刚立项的游戏项目可以直接本地写死配置, 等正式上线客户端处理对接HTTP服务即可, 其他情况可以把 `JSON` 写入本地加载读取.

## 连接服务器

这里连接服务首先就是发起授权信息, 看起来很容易像是常规输入 `账号密码用户登录` 那样简单, 但是其中涉及到很多隐藏复杂的数据也需要提交.

这里需要牵涉点额外的知识, 那就是 `游戏发行的对接`.

`游戏发行` 是游戏研发的外围需求, 一般会用于 `广告|主播推广` 这样推广自身, 所以需要获取到广告转化情况.

一般游戏发行流程转化处理, 用于确认游戏推广买量汇总:

1. 游戏研发推广上架落地页面或者广告素材提交, 比如会从 `抖音(巨量)|微信(广点通)` 等提交广告下载地址
2. 游戏发行按照推广价格, 按量开始投放到广告位
3. 玩家看到广告并点击广告跳转|下载, 这时候会被游戏发行记作感兴趣玩家 `记录标识(本地用户指纹)`
4. 玩家下载完成之后, 在首次启动会提交本地环境构建的 `记录标识(本地用户指纹,也就是上面触发广告用户)`
5. 这时候获取到用户从 `看广告 - 点击广告 - 下载游戏` 流程标识, 说明是有效的感兴趣玩家
6. 后续注册需要把环境数据提交( `IMEI|IP` 等环境唯一标识 )用于关联之前的 `记录标识(本地用户指纹)`
7. 这时候游戏发行已经确认 `看广告 - 点击广告 - 下载游戏 - 注册玩家`, 这就是有效的买量玩家量从而方便统计玩家注册|登录汇总

说了这么久就是需要登录的时候需要将本地部分数据以JSON提交上来让服务端写入日志, 方便游戏发行关联有效的推广转化玩家.

这里提供几个首次提交登录授权的网络协议, 并且说明为什么要定义这些字段.

### 协议说明

这里提供个最简单的授权请求协议:

```plain
.c2s_login_req
    //请求登录, 客户端连接成功后发的第一条协议
    {
        uint:sid        // 服务器id
        uint:ver        // 游戏客户端版本号
        string:username // 账号
        string:password // 密码
    }
```

这里是最简单的授权登录协议, 主要字段功能:

- `服务器ID|客户端版本`: 用于验证服务器和客户端版本信息
- `账号|密码`: 客户端直接提交的授权信息

这里是很简单不涉及到 `游戏发行` 和 `第三方API登录` 的授权提交, 客户端只管直接提交账号由服务端验证判断.

> 这种情况用于小型项目, 不用直接构建SDK的API用来做服务器列表请求, 直接连接到游戏服务器.

这种情况下游戏服务端要构建单独 `SDK` 层去连接数据库验证账号, 适合刚立项的时候需要做 `demo` 的情况.

后续扩展出来相对复杂的情况:

```plain
.c2s_login_req
    //请求登录, 客户端连接成功后发的第一条协议
    {
        uint:sid        // 服务器id
        uint:ver        // 游戏客户端版本号
        uint:ty         // 登录类型: 1-账号密码|2-Token登录|3-Google登录|4-微信登录.... 
        string:username // 账号: 如果需要账号|标识追加, 否则传递空字符串
        string:password // 密码和Token
        string:device   // 客户端提交的设备信息JSON, 用于写入登录日志时候记录当时玩家设备信息
    }
```

这里追加 `登录类型` 和 `设备信息JSON` 都是游戏发行方会使用的数据需要接收并写入.









